{% extends 'account/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<div id="appCapsule">
	<!-- Wallet Card -->
	<div class="section wallet-card-section pt-1">
		<div class="wallet-card">
			<div class="balance">
				<div class="left">
					<span class="title">Total Balance</span>
					<h1 class="total">$ {{total_balance|intcomma}}</h1>
				</div>
				<div class="right"></div>
			</div>
			<div class="wallet-footer">
				<div class="item">
					<a href="fund">
						<div class="icon-wrapper"><ion-icon name="arrow-up-outline"></ion-icon></div>
						<strong>Deposit</strong>
					</a>
				</div>
				<div class="item">
					<a href="{% url 'withdraw' %}">
						<div class="icon-wrapper bg-danger"><ion-icon name="arrow-down-outline"></ion-icon></div>
						<strong>Withdraw</strong>
					</a>
				</div>
				<div class="item">
					<a href="{% url 'invest' %}">
						<div class="icon-wrapper bg-warning"><ion-icon name="swap-vertical"></ion-icon></div>
						<strong>Invest</strong>
					</a>
				</div>
			</div>
		</div>
	</div>
	<!-- * Wallet Card -->

	<!-- (Other modals you had: send / convert) -->

	<!-- Stats -->
	<div class="section">
		<div class="row mt-2">
			<div class="col-6">
				<div class="stat-box">
					<div class="title">Profit In Wallet</div>
					<div class="value text-success" style="font-size:20px;">$ {{request.user.profit|intcomma}}</div>
				</div>
			</div>
			<div class="col-6">
				<div class="stat-box">
					<div class="title">Copy Expenses</div>
					<div class="value text-danger" style="font-size:20px;">$ {{request.user.copy_expenses|intcomma}}</div>
				</div>
			</div>
		</div>
		<div class="row mt-2">
			<div class="col-6">
				<div class="stat-box">
					<div class="title">ROI Investment</div>
					<div class="value text-success" style="font-size:20px;">$ {{request.user.roi_investment|intcomma}}</div>
				</div>
			</div>
			<div class="col-6">
				<div class="stat-box">
					<div class="title">Deposit Balance</div>
					<div class="value" style="font-size:20px;">$ {{request.user.current_deposit|intcomma}}</div>
				</div>
			</div>
		</div>
	</div>
	<!-- * Stats -->

	<div class="wallet-card">
		<!-- TradingView Widget BEGIN -->
		<div class="tradingview-widget-container">
			<div id="tradingview_fdfe1"></div>
			<div class="tradingview-widget-copyright">
				<a href="https://www.tradingview.com/symbols/NASDAQ-AAPL/" rel="noopener" target="_blank"><span
						class="blue-text">AAPL stock chart</span></a> by TradingView
			</div>
			<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
			<script type="text/javascript">
				new TradingView.widget({
					"width": "100%",
					"height": 400,
					"symbol": "NASDAQ:AAPL",
					"interval": "D",
					"timezone": "Etc/UTC",
					"theme": "dark",
					"style": "2",
					"locale": "en",
					"toolbar_bg": "#f1f3f6",
					"enable_publishing": false,
					"allow_symbol_change": true,
					"container_id": "tradingview_fdfe1"
				});
			</script>
		</div>
		<!-- TradingView Widget END -->
	</div>

	<div class="section mt-4 mb-5 pb-4">
		<div class="wallet-card">
			<div style="display:flex; justify-content:flex-end; padding:20px 20px 0 20px;">
				<a href="{% url 'copy-trader' %}" class="btn btn-primary"><i class="bx bx-user"></i> Copy an Expert</a>
			</div>

			<!-- Trading Form -->
			<div class="wallet-card" style="padding:40px; margin-top:20px;">
				<form method="post" style="max-width:100%; margin:0 auto;">
					{% csrf_token %}
					<div class="mb-4" style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">
						<div style="width:280px;">
							<label
								style="color:#fff; font-size:15px; margin-bottom:15px; display:block; text-align:center;">Category</label>
							<select class="form-select" name="category" required>
								<option value="crypto" selected>Crypto Currency</option>
								<option value="currency">Currencies</option>
							</select>
						</div>
						<div style="width:280px;">
							<label
								style="color:#fff; font-size:15px; margin-bottom:15px; display:block; text-align:center;">Symbol</label>
								<select name="ticker" class="form-select" required>
									<option value="BCH/BTC" selected>BCH/BTC</option>
									<option value="BCH/EUR">BCH/EUR</option>
									<option value="BCH/GBP">BCH/GBP</option>
									<option value="BTC-EOS">BTC-EOS</option>
									<option value="BTC/EUR">BTC/EUR</option>
									<option value="BTC/GBP">BTC/GBP</option>
									<option value="BTC/USD">BTC/USD</option>
									<option value="BTC/USDC">BTC/USDC</option>
									<option value="BTC/USDT">BTC/USDT</option>
									<option value="DOGE/USDT">DOGE/USDT</option>
									<option value="EOS/BTC">EOS/BTC</option>
									<option value="EOS/EUR">EOS/EUR</option>
									<option value="EOS/USD">EOS/USD</option>
									<option value="ETC/BTC">ETC/BTC</option>
									<option value="ETC/EUR">ETC/EUR</option>
									<option value="ETC/GBP">ETC/GBP</option>
									<option value="ETC/USD">ETC/USD</option>
									<option value="ETH/BTC">ETH/BTC</option>
									<option value="ETH/EUR">ETH/EUR</option>
									<option value="ETH/GBP">ETH/GBP</option>
									<option value="LTC/USD">LTC/USD</option>
									<option value="LTC/USDT">LTC/USDT</option>
									<option value="MKR/BTC">MKR/BTC</option>
									<option value="PCP-BTC">PCP-BTC</option>
									<option value="REP/BTC">REP/BTC</option>
									<option value="SHIB/USDT">SHIB/USDT</option>
									<option value="TRX/USDT">TRX/USDT</option>
									<option value="TRX/GBP">TRX/GBP</option>
									<option value="XAU/USD">XAU/USD</option>
									<option value="XLM/BTC">XLM/BTC</option>
									<option value="XLM/EUR">XLM/EUR</option>
									<option value="XLM/USD">XLM/USD</option>
									<option value="XRP/USDT">XRP/USDT</option>
									<option value="XRP/BTC">XRP/BTC</option>
									<option value="XRP/EUR">XRP/EUR</option>
									<option value="XRP/USD">XRP/USD</option>
									<option value="ZEC/BTC">ZEC/BTC</option>
									<option value="ZRX/BTC">ZRX/BTC</option>
									<option value="ZRX/EUR">ZRX/EUR</option>
									<option value="ZRX/USD">ZRX/USD</option>
								</select>								
						</div>
						<div style="width:280px;">
							<label for="strike"
								style="color:#fff; font-size:15px; margin-bottom:15px; display:block; text-align:center;">Strike
								Rate</label>
								<select name="striker" id="strike" class="form-select" required>
									<option value="60% & 1%" selected>60% & 1%</option>
									<option value="29% & 1%">29% & 1%</option>
									<option value="5% & 2%">5% & 2%</option>
									<option value="5% & 11%">5% & 11%</option>
									<option value="1% & 85%">1% & 85%</option>
								</select>
								
						</div>
					</div>

					<div class="mb-4" style="display:flex; justify-content:center;">
						<div style="width:850px; max-width:90%;">
							<label
								style="color:#fff; font-size:15px; margin-bottom:15px; display:block; text-align:center;">Amount</label>
							<input name="amount" type="number" class="form-control" placeholder="Enter amount" required>
						</div>
					</div>

					<div class="mb-4" style="display:flex; justify-content:center;">
						<div style="width:580px; max-width:90%;">
							<label
								style="color:#fff; font-size:15px; margin-bottom:15px; display:block; text-align:center;">Interval</label>
							<select name="interval" class="form-select" required>
								<option value="1" selected>1 min</option>
								<option value="3">3 min</option>
								<option value="15">15 min</option>
								<option value="30">30 min</option>
							</select>
						</div>
					</div>

					<div style="display:flex; justify-content:center; gap:15px;">
						<form action="" method="post">
							{% csrf_token %}
							<button type="submit" class="btn btn-success" name="buy"
							style="width:140px; padding:14px; font-size:16px; font-weight:500; border-radius:8px;"
							id="buyBtn">Buy</button>
						</form>
						
						<form action="" method="post">
							{% csrf_token %}
							<button type="submit" class="btn btn-danger" name="sell"
							style="width:140px; padding:14px; font-size:16px; font-weight:500; border-radius:8px;"
							id="sellBtn">Sell</button>
						</form>
					</div>
				</form>
			</div>
			<!-- * Trading Form -->
		</div>

		<!-- Custom Success Modal -->
		<div id="customSuccessModal"
			style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:99999;">
			<!-- Backdrop -->
			<div
				style="position:absolute; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:1;">
			</div>

			<!-- Modal Content -->
			<div
				style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:2; width:90%; max-width:360px;">
				<div
					style="background-color:#fff; border-radius:8px; padding:35px 30px 25px 30px; box-shadow:0 10px 40px rgba(0,0,0,0.2); border:none;">
					<!-- Success Icon -->
					<div style="margin-bottom:20px; display:flex; justify-content:center;">
						<div
							style="width:70px; height:70px; margin:0 auto; border:3px solid #d4f4dd; border-radius:50%; display:flex; align-items:center; justify-content:center; background-color:#fff;">
							<svg viewBox="0 0 52 52" style="width:40px; height:40px; display:block; margin:0 auto;">
								<path
									style="stroke:#7bc96f; stroke-width:6; stroke-linecap:round; stroke-linejoin:round; fill:none;"
									d="M14.1 27.2l7.1 7.2 16.7-16.8"></path>
							</svg>
						</div>
					</div>

					<!-- Title & Message -->
					<h2
						style="font-size:22px; font-weight:400; color:#000 !important; margin-bottom:6px; text-align:center;">
						Great</h2>
					<p style="font-size:14px; color:#666 !important; margin-bottom:25px; text-align:center;">Live Trade
						Activated</p>

					<!-- OK Button (Right-aligned) -->
					<div style="display:flex; justify-content:flex-end; margin-top:15px;">
						<button type="button" onclick="closeCustomModal()"
							style="background-color:#5ba3c5; border:2px solid #5ba3c5; border-radius:6px; color:#fff; font-size:14px; font-weight:500; padding:8px 30px; cursor:pointer; transition:all 0.2s; display:inline-block; width:auto; max-width:none;">OK</button>
					</div>
				</div>
			</div>
		</div>
		<!-- * Custom Success Modal -->

		<!-- Active Trades Section -->
		<article class="my-4">
			<h2>Active Trades</h2>
			<div class="card">
				<div class="card-body">
					<div class="alert alert-info">
						Live trades running in the background. Refresh to view updates
					</div>
					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th>ID</th>
									<th>Amount</th>
									<th>Progress</th>
									<th>Interval</th>
									<!-- <th>Entry Price</th> -->
									<th>Date</th>
								</tr>
							</thead>
							<tbody>
								{% for ot in open_trades %}
								<tr>
									<td><b>{{ ot.ref }}</b></td>
									<td><b>$ {{ot.amount|intcomma}}</b></td>
									<td>
										<div class="line-loader"></div>
									</td>
									<td><b>{{ot.interval}} Min</b></td>
									<!-- <td><b>{{ot.entry_price}}</b></td> -->
									<td><b>{{ot.opened_at|date:"l jS \o\f F Y"}}</b></td>
								</tr>
								{% empty %}
								<tr>
									<td colspan="6">No active trades found.</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</article>
		<!-- * Active Trades Section -->

		<!-- Expert Trades Section -->
		<div class="section mt-4 mb-5 pb-4">
			<div class="section-heading">
				<h2 class="title">Expert Trades</h2>
				<a href="trades" class="link"
					style="color:#fff; text-decoration:underline; border:none; background:transparent; padding:0;">View
					All</a>
			</div>
			<div class="transactions">
				<!-- item -->
				 {% for ct in copied_traders %}
				<a href="#" class="item">
					<div class="detail">
						<img src="{{ct.trader.image.url}}" alt="img" class="image-block imaged w48">
						<div>
							<strong>{{ct.trader.name}}</strong>
							<p>{{ct.opened_date|date:"Y-n-j G:i:s"}}</p>
						</div>
					</div>
					<div class="right">
						Amount Copying
						<div class="price text-success">${{ct.amount_copying|intcomma}}</div>
						<p>Profit: <strong>${{ct.current_profit|intcomma}}</strong></p>
					</div>
				</a>
				{% empty %}
				<p>No expert trades found.</p>
				{% endfor %}
			</div>
		</div>
		<!-- * Expert Trades Section -->

	</div>
</div>
{% endblock content %}