{% extends 'manager/base.html' %}
{% load static %}
{% block content %}

<div class="col-12 mb-4">

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Withdrawals</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Wallet Address</th>
                            <th>Fee</th>
                            <th>Fee Amount</th>
                            <th>Status</th>
                            <th>Approve</th>
                            <th>Decline</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Wallet Address</th>
                            <th>Fee</th>
                            <th>Fee Amount</th>
                            <th>Status</th>
                            <th>Approve</th>
                            <th>Decline</th>
                        </tr>
                    </tfoot>
                    <tbody>
                        {% for w in withdraws %}
                        <tr>
                            <td>{{w.user.first_name}} {{w.user.last_name}}</td>
                            <td>{{w.user.email}}</td>

                            <td>${{w.available_for_withdraw}} out of {{w.amount}} </td>
                            <td>{{w.name}}</td>
                            <td>{{w.wallet_address}}</td>
                            <td>${{w.amount}}</td>
                            <td>${{w.charges}}</td>
                            <td>{{w.status}}</td>
                            <td>
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#approveModal{{ w.id }}">
                                    Approve
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn border btn-light" data-toggle="modal" data-target="#declineModal{{ w.id }}">
                                    <i>&times;</i>
                                </button>
                            </td>

                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</div>

{% for w in withdraws %}

<!-- ===================== APPROVE MODAL ===================== -->
<div class="modal fade" id="approveModal{{ w.id }}" tabindex="-1" aria-labelledby="approveLabel{{ w.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="approveLabel{{ w.id }}">Approve Withdrawal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{% url 'approve_withdrawal' w.id %}">
        {% csrf_token %}
        <div class="modal-body">
          <p>Are you sure you want to approve this withdrawal?</p>
          <p><strong>Amount:</strong> ${{ w.available_for_withdraw }}</p>
          <p><strong>User:</strong> {{ w.user.first_name }} {{ w.user.last_name }}</p>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Confirm Approve</button>
        </div>
      </form>

    </div>
  </div>
</div>

<!-- ===================== DECLINE MODAL ===================== -->
<div class="modal fade" id="declineModal{{ w.id }}" tabindex="-1" aria-labelledby="declineLabel{{ w.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="declineLabel{{ w.id }}">Decline Withdrawal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{% url 'decline_withdrawal' w.id %}">
        {% csrf_token %}
        <div class="modal-body">
            <div class="form-group">
                <label>Reason for decline</label>
                <textarea name="reason" class="form-control" required placeholder="Enter reason..."></textarea>
            </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Confirm Decline</button>
        </div>
      </form>

    </div>
  </div>
</div>

{% endfor %}

{% endblock %}